<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collectibles Game</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <!-- Остальная часть сцены остается без изменений -->
    <a-scene physics="debug: true; gravity: -9.8;" vr-mode-ui="enabled: true">
        <!-- ... все предыдущие элементы сцены ... -->
    </a-scene>

    <script>
        // ... предыдущий код таймера и логики игры ...

        // Создание кастомной геометрии с помощью BufferGeometry
        function createCustomGeometry() {
            const geometry = new THREE.BufferGeometry();
            
            // Вершины для треугольной пирамиды
            const vertices = new Float32Array([
                0.0, 1.0, 0.0,   // вершина
                -1.0, -1.0, 1.0, // основание
                1.0, -1.0, 1.0,
                1.0, -1.0, -1.0,
                -1.0, -1.0, -1.0
            ]);

            // Индексы для треугольников
            const indices = new Uint16Array([
                0, 1, 2,    // передняя грань
                0, 2, 3,    // правая грань
                0, 3, 4,    // задняя грань
                0, 4, 1,    // левая грань
                1, 2, 3,    // нижняя грань 1
                1, 3, 4     // нижняя грань 2
            ]);

            geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));
            geometry.setIndex(new THREE.BufferAttribute(indices, 1));
            geometry.computeVertexNormals();

            return geometry;
        }

        // Создание материалов
        const customMaterial = new THREE.MeshStandardMaterial({
            color: 0xff0000,
            metalness: 0.3,
            roughness: 0.4
        });

        // Модифицированная функция создания коллекционных объектов
        function createCollectibles() {
            const positions = spawnObjects();
            const geometry = createCustomGeometry();
            
            positions.forEach(pos => {
                // Создание Three.js меша
                const mesh = new THREE.Mesh(geometry, customMaterial);
                mesh.scale.set(0.5, 0.5, 0.5);
                
                // Создание A-Frame entity для интеграции Three.js объекта
                const entity = document.createElement('a-entity');
                entity.setAttribute('position', pos);
                entity.setAttribute('class', 'collectible');
                entity.setAttribute('dynamic-body', 'shape: none;'); // Отключаем автоматическую форму коллизий
                
                // Добавляем Three.js объект в A-Frame
                entity.object3D.add(mesh);
                
                // Ручное создание формы коллизий
                const physicsShape = new Ammo.btBoxShape(
                    new Ammo.btVector3(0.5, 0.5, 0.5)
                );
                
                entity.setAttribute('body__collider', {
                    shape: 'box',
                    halfExtents: {x: 0.5, y: 0.5, z: 0.5}
                });

                document.querySelector('a-scene').appendChild(entity);
            });
        }

        // ... остальной код без изменений ...
    </script>
</body>
</html>
